<h1>Search the Stacks</h1>

<div class="search-wrap">
  <%= form_with url: books_path, method: :get, local: true do %>
    <%= text_field_tag :q, @query, placeholder: "Search by title or author" %>
    <%= submit_tag "Search", class: "btn" %>
  <% end %>
</div>

<% if @query.present? %>
  <p class="muted">Showing <%= @books.size %> result(s) for “<%= @query %>”.</p>
  <% if @books.any? %>
    <div class="book-grid">
      <% @books.each do |book| %>
        <%= render "book_card", book: book %>
      <% end %>
    </div>
  <% else %>
    <p class="muted">No matches. Try another keyword.</p>
  <% end %>
<% else %>
  <p class="muted">Type a title or author and press Search.</p>
<% end %>

<% if logged_in? && @personalized_sections.present? %>
  <h2>Your Favorite Categories</h2>

  <% @personalized_sections.each do |section| %>
    <h3><%= section[:category].name %></h3>
    <div class="book-grid">
      <% section[:books].each do |book| %>
        <%= render "book_card", book: book %>
      <% end %>
    </div>
  <% end %>
<% end %>

