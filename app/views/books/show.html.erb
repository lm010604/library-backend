<div class="book-show">
  <h1><%= @book.title %></h1>
  <p><strong>Author:</strong> <%= @book.author %></p>
  <p><strong>Average rating:</strong> <%= @book.average_rating || "No ratings yet" %></p>
  <% if @book.description.present? %>
    <p><%= simple_format(@book.description) %></p>
  <% end %>

  <% if logged_in? %>
    <% if current_user.library_entries.exists?(book_id: @book.id) %>
       <%= button_to "Remove from My Library",
              remove_from_library_book_path(@book),
              method: :delete, class: "btn" %>
    <% else %>
      <%= button_to "Add to My Library",
              add_to_library_book_path(@book),
              method: :post, class: "btn" %>
    <% end %>
  <% end %>

  <hr class="rule">

  <h3 id="reviews">Reviews</h3>
  <% if @reviews.any? %>
    <div class="review-grid">
      <% @reviews.each do |review| %>
        <%= render "reviews/review_card", review: review, show_book: false %>
      <% end %>
    </div>
    <div class="review-pagination top-bar">
      <% if @page.positive? %>
        <%= link_to "Back", book_path(@book, page: @page - 1) + "#reviews", class: "btn" %>
      <% end %>
      <% if @has_next %>
        <%= link_to "Next", book_path(@book, page: @page + 1) + "#reviews", class: "btn" %>
      <% end %>
    </div>
  <% else %>
    <p class="muted">No reviews yet.</p>
  <% end %>

  <hr class="rule">

  <% if logged_in? %>
    <h3>Write a review</h3>
    <%= form_with model: [@book, @review], local: true, html: { class: "form-panel" } do |f| %>
      <div class="field">
        <%= f.label :rating %>
        <%= f.hidden_field :rating, value: 3, data: { rating_target: "input" } %>
        <div class="star-rating" data-controller="rating" data-rating-target="stars">
          <% (1..5).each do |star| %>
            <span
              class="star"
              data-action="click->rating#set mouseover->rating#hover mouseout->rating#resetHover"
              data-rating-value="<%= star %>"
            >â˜…</span>
          <% end %>
        </div>
      </div>

      <div class="field field--full">
        <%= f.label :body, "Your review" %>
        <%= f.text_area :body, rows: 6, placeholder: "What did you think?" %>
      </div>

      <div class="actions">
        <%= f.submit "Post review" %>
      </div>
    <% end %>
  <% else %>
    <p class="muted"><%= link_to "Sign in", new_session_path %> to write a review.</p>
  <% end %>
</div>
