<div class="book-show">
  <h1><%= @book.title %></h1>
  <p><strong>Author:</strong> <%= @book.author %></p>
  <p><strong>Average rating:</strong> <%= @book.average_rating || "No ratings yet" %></p>
  <% if @book.description.present? %>
    <p><%= simple_format(@book.description) %></p>
  <% end %>

  <hr class="rule">

  <h3>Reviews</h3>
  <% if @reviews.any? %>
    <div class="review-grid">
      <% @reviews.each do |review| %>
        <%= render "reviews/review_card", review: review, show_book: false %>
      <% end %>
    </div>
    <div class="review-pagination top-bar">
      <% if @page.positive? %>
        <%= link_to "Back", book_path(@book, page: @page - 1), class: "btn" %>
      <% end %>
      <% if @has_next %>
        <%= link_to "Next", book_path(@book, page: @page + 1), class: "btn" %>
      <% end %>
    </div>
  <% else %>
    <p class="muted">No reviews yet.</p>
  <% end %>

  <hr class="rule">

  <% if logged_in? %>
    <h3>Write a review</h3>
    <%= form_with model: [@book, @review], local: true, html: { class: "form-panel" } do |f| %>
      <div class="field">
        <%= f.label :rating %>
        <%= f.number_field :rating, in: 1..5, class: "input-narrow" %>
      </div>

      <div class="field field--full">
        <%= f.label :body, "Your review" %>
        <%= f.text_area :body, rows: 6, placeholder: "What did you think?" %>
      </div>

      <div class="actions">
        <%= f.submit "Post review" %>
      </div>
    <% end %>
  <% else %>
    <p class="muted"><%= link_to "Sign in", new_session_path %> to write a review.</p>
  <% end %>
</div>
